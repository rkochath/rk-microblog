<!DOCTYPE html>
<html>
  <head>
    {% if title %}
    <title>{{title}} - microblog</title>
    {% else %}
    <title>microblog</title>
    {% endif %}
    <link href="{{ url_for('.static', filename = 'css/bootstrap.min.css') }}" rel="stylesheet" media="screen">
    <link href="{{ url_for('.static', filename = 'css/bootstrap-responsive.min.css') }}" rel="stylesheet">
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    {{ fujs.js }}
    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
    <link rel="stylesheet" href="/resources/demos/style.css" />
    <script src="{{ url_for('.static', filename = 'js/bootstrap.min.js') }}"></script>
    <script src="{{ url_for('.static', filename = 'js/moment.min.js') }}"></script>

    {% if g.locale != 'en' %}
    <script src="{{ url_for('.static', filename = 'js/moment-' + g.locale + '.min.js') }}"></script>
    {% endif %}
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>

    function translate(sourceLang, destLang, sourceId, destId, loadingId) {
        $(destId).hide();
        $(loadingId).show();
        $.post('/translate', {
            text: $(sourceId).text(),
            sourceLang: sourceLang,
            destLang: destLang
        }).done(function(translated) {
            $(destId).text(translated['text'])
            $(loadingId).hide();
            $(destId).show();
        }).fail(function() {
            $(destId).text("{{ _('Error: Could not contact server.') }}");
            $(loadingId).hide();
            $(destId).show();
        });
    }
    $(function() {
    $( "#start_date" ).datepicker();
    });

   $(function() {
    $( "#end_date" ).datepicker();
    });

   function calculate() {
		var start_date = document.getElementById('start_date');
		var end_date = document.getElementById('end_date');
		var no_vacations = document.getElementById('no_vacations');	
		var no_holidays = document.getElementById('no_holidays');	
		var no_sickdays = document.getElementById('no_sickdays');	
		var hourly_rate = document.getElementById('hourly_rate');	
		var work_hours = document.getElementById('work_hours');
		var exclude_nth = document.getElementById('exclude_nth');	
		var exclude_day = document.getElementById('exclude_day');		

		$.post('/calculate', {
		    start_date:start_date.value,
		    end_date:end_date.value,
		    no_vacations:no_vacations.value,
		    no_holidays:no_holidays.value,
		    no_sickdays:no_sickdays.value,
		    hourly_rate:hourly_rate.value,
		    work_hours:work_hours.value,
		    exclude_nth:exclude_nth.value,	
		    exclude_day:exclude_day.value 	

		}).done(function(result) {
		   document.getElementById('income').value = parseFloat(result['income']);
		}).fail(function() {
		    $(income).text('***')            
		});

	    }
	


   function calculate_expense() {

	    var start_date = document.getElementById('start_date');
	    var end_date = document.getElementById('end_date');
	    var is_rent_acar = document.getElementById('is_rent_acar').checked?'true':'false';
	    var rental_st_day = document.getElementById('rental_st_day');
	    var rental_end_day = document.getElementById('rental_end_day');
            var rental_car_rate = document.getElementById('rental_car_rate');
	    var is_hotel = document.getElementById('is_hotel').checked?'true':'false';
	    var hotel_st_day = document.getElementById('hotel_st_day');
	    var hotel_end_day = document.getElementById('hotel_end_day');
	    var is_flight = document.getElementById('is_flight').checked?'true':'false';
	    var is_airport_pickup = document.getElementById('is_airport_pickup').checked?'true':'false';
	    var is_mileage = document.getElementById('is_mileage').checked?'true':'false';
	    var commute_st_day = document.getElementById('commute_st_day');
	    var commute_end_day = document.getElementById('commute_end_day');
	    var rental_car_rate = document.getElementById('rental_car_rate');
	    var hotel_rate = document.getElementById('hotel_rate');
	    var flight_ticket = document.getElementById('flight_ticket');
	    var airport_pickup = document.getElementById('airport_pickup');
	    var daily_expense = document.getElementById('daily_expense');
	    var daily_miles = document.getElementById('daily_miles');
	    var mileage_rate = document.getElementById('mileage_rate');
	    
	    
	    $.post('/calculate_expense', {
		    start_date:start_date.value,
		    end_date:end_date.value,
		    is_rent_acar :is_rent_acar,
		    rental_st_day :rental_st_day.value,
		    rental_end_day:rental_end_day.value,
		    rental_car_rate:rental_car_rate.value,
		    is_mileage:is_mileage ,
		    commute_st_day:commute_st_day.value,
		    commute_end_day:commute_end_day.value,
		    daily_miles:daily_miles.value,
		    mileage_rate:mileage_rate.value, 
		    is_hotel:is_hotel ,
		    hotel_st_day:hotel_st_day.value,
		    hotel_end_day:hotel_end_day.value,
		    hotel_rate:hotel_rate.value,
		    
		    daily_expense:daily_expense.value,
		    is_flight:is_flight ,
		    flight_ticket:flight_ticket.value,
	
		    is_airport_pickup:is_airport_pickup ,
		    airport_pickup:airport_pickup.value
		    
		    
		}).done(function(result) {
		   document.getElementById('expense').value = parseFloat(result['expense']);	
		}).fail(function() {
		    $(income).text('***')            
		});


	    }



   function save_contract() {
		console.log("inside save contract");
		var contract_id = -1;
		console.log("going to post");




	var mypost = $.post('/save_contract',$( "#rate_input_form"  ).serialize() ).done(function(result) {
		  console.log("done with result"+result);
		  document.getElementById('id').value = parseInt(result['id']);	
		  contract_id = parseInt(result['id']);
		  //console.log("Updated for id"+contract_id);	
		}).fail(function(jqXHR, textStatus, errorThrown) {
		  var responseText = jQuery.parseJSON(errorThrown.responseText);
        	  //alert(responseText);
		  console.log(textStatus + ":"+ errorThrown);
		});
	
/*
	$.ajax({
		url: '/save_contract',
		type: 'POST'
	    },
	    data: $('#rate_input_form').serialize(),
	    success: function () {
		console.log(result['id']);
		contract_id=result['id'];
	    },
	    error: function (errorThrown) {
		data = JSON.parse(errorThrown.responseText);
		console.log(data.error+ ":" + errorThrown);
	    }
	});
*/

	//alert("Contract id returned "+ contract_id + ":))" );
	return contract_id;

	    }

   function update_deductions() {
	    var id = document.getElementById('id');
	    var is_rent_acar = document.getElementById('is_rent_acar').checked?'true':'false';
	    var rental_st_day = document.getElementById('rental_st_day');
	    var rental_end_day = document.getElementById('rental_end_day');
	    var is_hotel = document.getElementById('is_hotel').checked?'true':'false';
	    var hotel_st_day = document.getElementById('hotel_st_day');
	    var hotel_end_day = document.getElementById('hotel_end_day');
	    var is_flight = document.getElementById('is_flight').checked?'true':'false';
	    var is_airport_pickup = document.getElementById('is_airport_pickup').checked?'true':'false';
	    var is_mileage = document.getElementById('is_mileage').checked?'true':'false';
	    var commute_st_day = document.getElementById('commute_st_day');
	    var commute_end_day = document.getElementById('commute_end_day');
	    var rental_car_rate = document.getElementById('rental_car_rate');
	    var hotel_rate = document.getElementById('hotel_rate');
	    var flight_ticket = document.getElementById('flight_ticket');
	    var airport_pickup = document.getElementById('airport_pickup');
	    var daily_expense = document.getElementById('daily_expense');
	    var daily_miles = document.getElementById('daily_miles');
	    var mileage_rate = document.getElementById('mileage_rate');
	    var expense = document.getElementById('expense');
	    alert("Going to update expense");

	$.post('/update_deductions', {
		    id :id.value,
		    is_rent_acar :is_rent_acar,
		    rental_st_day :rental_st_day.value,

		    rental_end_day:rental_end_day.value,
		    is_hotel:is_hotel,
		    hotel_st_day:hotel_st_day.value,

		    hotel_end_day:hotel_end_day.value,

		    is_flight:is_flight,
	
		    is_airport_pickup:is_airport_pickup,
		    is_mileage:is_mileage,

		    commute_st_day:commute_st_day.value,
		    commute_end_day:commute_end_day.value,
		    rental_car_rate:rental_car_rate.value,
		    hotel_rate:hotel_rate.value,
		    flight_ticket:flight_ticket.value,
		    airport_pickup:airport_pickup.value,
		    daily_expense:daily_expense.value,
		    daily_miles:daily_miles.value,
		    mileage_rate:mileage_rate.value,
		    expense:expense.value	 
		}).fail(function() {
		  var responseText = jQuery.parseJSON(jqXHR.responseText);
        	  //alert(responseText);
		  //console.log(responseText);
		  alert("Status :" + textStatus + ":" + responseText );
		});


	    }


    </script>
  </head>
  <body>
    <div class="container">
      <div class="navbar">
        <div class="navbar-inner">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="{{ url_for('index') }}">microblog</a>
            <!--
	    <ul class="nav">
	    -->
	    <ul class="nav nav-pills">  
              <li><a href="{{ url_for('index') }}">{{ _('Home') }}</a></li>
              {% if g.user.is_authenticated() %}
              <li><a href="{{ url_for('user', nickname = g.user.nickname) }}">{{ _('Your Profile') }}</a></li>
              <li><a href="{{ url_for('contracts_list') }}">{{ _('RateCalc') }}</a></li>
	      <li><a href="{{ url_for('envelope_list') }}">{{ _('Bust-A-Bill') }}</a></li>

              <li><a href="{{ url_for('logout') }}">{{ _('Logout') }}</a></li>
              {% endif %}
            </ul>
          <div class="nav-collapse collapse">
            {% if g.user.is_authenticated() and g.search_enabled %}
            <form class="navbar-search pull-right" action="{{url_for('search')}}" method="post" name="search">{{g.search_form.hidden_tag()}}{{g.search_form.search(size=20,placeholder=_('Search'),class="search-query")}}</form>
            {% endif %}
          </div>
        </div>
      </div>
      <div class="row">
        <div class="span12">
          {% block content %}{% endblock %}
        </div>
      </div>
    </div>   
  </body>
</html>
